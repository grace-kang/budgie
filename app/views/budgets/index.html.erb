<div class="budgets">
  <% @months.each do |month| %>
    <div class="month">
      <div class="month-header">
        <h3><%= Date.new(month.year, month.month).strftime('%B %Y').upcase %></h3>
      </div>
      <% month.budgets.each do |budget| %>
        <%= link_to budget do %>
          <% remaining = budget.total - budget.transactions.sum(&:amount) %>
          <% bg_class =
               if remaining.negative?
                 'budget-over'
               else
                 remaining < 50 ? 'budget-warn' : 'budget-ok'
               end %>
          <div class="budget <%= bg_class %>">
            <span><%= budget.name %></span>
            <span><%= remaining %>
              /
              <%= budget.total %>
            </span>
          </div>
        <% end %>
      <% end %>
      <%= render 'form', budget: @budget %>
    </div>
  <% end %>
</div>
